class e{constructor(e,t,l){let s=document.createElement("div");s.classList.add("field-cell"),e.append(s),this.x=t,this.y=l}linkTile(e){e.setXY(this.x,this.y),this.linkedTile=e}unlinkTile(){this.linkedTile=null}linkTileForMerge(e){e.setXY(this.x,this.y),this.linkedTileForMerge=e}unlinkTileForMerge(){this.linkedTileForMerge=null}isEmpty(){return!this.linkedTile}canAccept(e){return this.isEmpty()||!this.hasTileForMerge()&&this.linkedTile.value===e.value}hasTileForMerge(){return!!this.linkedTileForMerge}mergeTiles(){let e=2*this.linkedTile.value;return this.linkedTile.setValue(e),this.linkedTileForMerge.removeFromField(),this.unlinkTileForMerge(),e}}class t{constructor(t){this.cells=[];for(let l=0;l<16;l++)this.cells.push(new e(t,l%4,Math.floor(l/4)));this.cellsGroupedByColumn=this.groupCellsByColumn(),this.cellsGroupedByRow=this.groupCellsByRow(),this.cellsGroupedByReversedColumn=this.cellsGroupedByColumn.map(e=>[...e].reverse()),this.cellsGroupedByReversedRow=this.cellsGroupedByRow.map(e=>[...e].reverse())}getRandomEmptyCell(){let e=this.cells.filter(e=>e.isEmpty()),t=Math.floor(Math.random()*e.length);return e[t]}groupCellsByColumn(){return this.cells.reduce((e,t)=>(e[t.x]=e[t.x]||[],e[t.x][t.y]=t,e),[])}groupCellsByRow(){return this.cells.reduce((e,t)=>(e[t.y]=e[t.y]||[],e[t.y][t.x]=t,e),[])}}class l{constructor(e){this.tile=document.createElement("div"),this.tile.classList.add("tile"),this.setValue(Math.random()>.2?2:4),e.append(this.tile)}setXY(e,t){this.x=e,this.y=t,this.tile.style.setProperty("--x",e),this.tile.style.setProperty("--y",t)}setValue(e){this.value=e,this.tile.textContent=e;let t=100-9*Math.log2(e);this.tile.style.setProperty("--bg-color",`${t}%`),this.tile.style.setProperty("--text-color",`${t<=50?90:10}%`)}removeFromField(){this.tile?.remove()}}const s=document.getElementById("game-field"),i=document.querySelector(".button"),r=document.querySelector(".game-score"),n=document.querySelector(".game-best"),o=document.querySelector(".message-start"),c=document.querySelector(".message-win"),d=document.querySelector(".message-lose"),u=document.querySelector(".message-end");let a=new t(s),h=0,m=+localStorage.getItem("bestScore")||0;function y(){window.addEventListener("keydown",p,{once:!0})}function p(e){switch(e.key){case"ArrowUp":if(!f()){y();return}g(a.cellsGroupedByColumn);break;case"ArrowDown":if(!k()){y();return}g(a.cellsGroupedByReversedColumn);break;case"ArrowLeft":if(!T()){y();return}g(a.cellsGroupedByRow);break;case"ArrowRight":if(!C()){y();return}g(a.cellsGroupedByReversedRow);break;default:y();return}let t=new l(s);if(a.getRandomEmptyCell().linkTile(t),!f()&&!k()&&!T()&&!C()){if(!c.classList.contains("hidden")){u.classList.remove("hidden");return}d.classList.remove("hidden");return}y()}function g(e){e.forEach(e=>(function(e){for(let t=1;t<e.length;t+=1){let l;if(e[t].isEmpty())continue;let s=e[t],i=t-1;for(;i>=0&&e[i].canAccept(s.linkedTile);)l=e[i],i--;l&&(l.isEmpty()?l.linkTile(s.linkedTile):l.linkTileForMerge(s.linkedTile),s.unlinkTile())}})(e)),a.cells.forEach(e=>{if(e.hasTileForMerge()){let t=e.mergeTiles();2048===t&&c.classList.remove("hidden"),h+=t,r.textContent=h,h>m&&(m=h,localStorage.setItem("bestScore",m),n.textContent=m)}})}function f(){return w(a.cellsGroupedByColumn)}function k(){return w(a.cellsGroupedByReversedColumn)}function T(){return w(a.cellsGroupedByRow)}function C(){return w(a.cellsGroupedByReversedRow)}function w(e){return e.some(e=>e.some((t,l)=>!(0===l||t.isEmpty())&&e[l-1].canAccept(t.linkedTile)))}n.textContent=m,i.addEventListener("click",function(){for(;s.firstChild;)s.removeChild(s.firstChild);(a=new t(s)).getRandomEmptyCell().linkTile(new l(s)),a.getRandomEmptyCell().linkTile(new l(s)),h=0,r.textContent=h,i.classList.replace("start","restart"),i.textContent="Restart",o.classList.add("hidden"),d.classList.add("hidden"),c.classList.add("hidden"),u.classList.add("hidden"),i.blur(),y()});
//# sourceMappingURL=index.c3234430.js.map
